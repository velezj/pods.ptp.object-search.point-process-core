
#include "context.hpp"
#include <sstream>
#include <iostream>

namespace point_process_core {



  //==========================================================================

  // Description:
  // The current global context
  static boost::optional<context_t> g_global_context;

  // Description:
  // The chaining context delimiter
  static std::string CHAINING_CONTEXT_DELIMITER = "/";

  //==========================================================================

  context_t chain_context( const context_t& new_context )
  {
    boost::optional<context_t> root_context = get_current_context();
    std::ostringstream oss;
    if( root_context ) {
      oss << root_context->id << CHAINING_CONTEXT_DELIMITER;
    }
    oss << new_context.id;
    return context_t( oss.str() );
  }

  //==========================================================================

  boost::optional<context_t> set_context( const boost::optional<context_t>& c )
  {
    boost::optional<context_t> original = g_global_context;
    g_global_context = c;

    // std::cout << "CONTEXT SWITCH: ";
    // if( c ) {
    //   std::cout << c->id;
    // } else {
    //   std::cout << "EMPTY";
    // }
    // std::cout << "  orig: ";
    // if( original ) {
    //   std::cout << original->id;
    // } else {
    //   std::cout << "EMPTY";
    // }
    // std::cout << std::endl;

    return original;
  }

  //==========================================================================

  boost::optional<context_t> get_current_context()
  {
    return g_global_context;
  }

  //==========================================================================

  std::string context_filename( const std::string& name )
  {
    boost::optional<context_t> context = get_current_context();
    std::ostringstream oss;
    if( context ) {
      oss << context->id << "_";
    }
    oss << name;
    return oss.str();
  }

  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================
  //==========================================================================



}
